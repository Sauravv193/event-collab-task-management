var R=Object.defineProperty,A=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var P=(s,r,t)=>r in s?R(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,L=(s,r)=>{for(var t in r||(r={}))U.call(r,t)&&P(s,t,r[t]);if(F)for(var t of F(r))Y.call(r,t)&&P(s,t,r[t]);return s},K=(s,r)=>A(s,J(r));var k=(s,r,t)=>new Promise((c,o)=>{var l=a=>{try{i(t.next(a))}catch(n){o(n)}},u=a=>{try{i(t.throw(a))}catch(n){o(n)}},i=a=>a.done?c(a.value):Promise.resolve(a.value).then(l,u);i((t=t.apply(s,r)).next())});import{c as N,a as w,b as T,z as m,j as e,B as v,e as H,u as V,L as _,m as Q,I as Z}from"./index-C9p9T0xJ.js";import{r as p}from"./vendor-CGzxjxki.js";import{u as C,j as G,d as W,b as X,e as ee}from"./eventService-B6VAk_os.js";import{u as f}from"./useMutation-DxIInw50.js";import{d as se,c as ae}from"./router-BtvKvBzC.js";import{U as te}from"./user-plus-Bxb4FVpO.js";import{C as re}from"./calendar-C-wrZFyD.js";/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=N("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=N("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=N("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=N("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=N("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),ce=s=>k(void 0,null,function*(){const{data:r}=yield w.get(`/tasks/event/${s}`);return r}),le=t=>k(void 0,[t],function*({taskData:s,eventId:r}){const{data:c}=yield w.post(`/tasks/event/${r}`,s);return c}),ue=t=>k(void 0,[t],function*({taskId:s,taskDetails:r}){const{data:c}=yield w.put(`/tasks/${s}`,r);return c}),he=s=>k(void 0,null,function*(){return yield w.delete(`/tasks/${s}`),s}),me=({task:s,eventId:r,isCreator:t})=>{const c=T(),o=f({mutationFn:ue,onSuccess:()=>{c.invalidateQueries({queryKey:["tasks",r]})},onError:i=>{var a,n;m.error(((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to update task.")}}),l=f({mutationFn:he,onSuccess:()=>{m.success("Task deleted!")},onError:i=>{var a,n;m.error(((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"You do not have permission to delete this task.")}}),u=i=>{o.mutate({taskId:s.id,taskDetails:K(L({},s),{status:i.target.value})})};return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:s.status,onChange:u,className:"rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 shadow-sm text-sm",children:[e.jsx("option",{value:"TO_DO",children:"To Do"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"DONE",children:"Done"})]}),t&&e.jsx("button",{onClick:()=>l.mutate(s.id),disabled:l.isPending,className:"text-red-500 hover:text-red-700 disabled:opacity-50",title:"Delete task",children:e.jsx($,{size:18})})]})]})},xe=({eventId:s,onComplete:r})=>{const[t,c]=p.useState(""),[o,l]=p.useState(""),u=T(),i=f({mutationFn:le,onSuccess:()=>{m.success("Task created!"),u.invalidateQueries({queryKey:["tasks",s]}),r()},onError:n=>{var b,x;m.error(((x=(b=n.response)==null?void 0:b.data)==null?void 0:x.message)||"Failed to create task.")}}),a=n=>{if(n.preventDefault(),!t.trim()){m.error("Task name cannot be empty.");return}const b={name:t,description:o,status:"TO_DO"};i.mutate({taskData:b,eventId:s})};return e.jsxs("form",{onSubmit:a,className:"p-4 my-4 bg-gray-100 dark:bg-gray-700 rounded-lg space-y-3",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white",children:"Add New Task"}),e.jsx("input",{type:"text",placeholder:"Task name (required)",value:t,onChange:n=>c(n.target.value),required:!0,className:"w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 shadow-sm"}),e.jsx("textarea",{placeholder:"Task description (optional)",value:o,onChange:n=>l(n.target.value),className:"w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 shadow-sm"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"ghost",onClick:r,children:"Cancel"}),e.jsx(v,{type:"submit",disabled:i.isPending,children:i.isPending?"Saving...":"Save Task"})]})]})},ge=({eventId:s,isMember:r,isCreator:t,isExpired:c})=>{const[o,l]=p.useState(!1),{data:u,isLoading:i,error:a}=C({queryKey:["tasks",s],queryFn:()=>ce(s),enabled:r});return e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-end mb-4",children:!o&&!c&&e.jsxs(v,{onClick:()=>l(!0),children:[e.jsx(ie,{size:16,className:"mr-2"}),"Add Task"]})}),o&&e.jsx(xe,{eventId:s,onComplete:()=>l(!1)}),i&&e.jsx("div",{className:"text-center p-4",children:"Loading tasks..."}),a&&e.jsx("div",{className:"text-red-500 text-center p-4",children:"Could not load tasks."}),!i&&!a&&e.jsx("div",{className:"space-y-3",children:u&&u.length>0?u.map(n=>e.jsx(me,{task:n,eventId:s,isCreator:t},n.id)):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"No tasks have been created yet."})})]})},Se=()=>{const{id:s}=se(),r=ae(),{stompClient:t}=H(),{user:c}=V(),o=T(),[l,u]=p.useState(""),i=p.useRef(null),{data:a,isLoading:n,error:b}=C({queryKey:["event",s],queryFn:()=>X(s)}),x=a==null?void 0:a.members.some(d=>d.username===c.username),E=(a==null?void 0:a.createdBy.username)===c.username,g=a==null?void 0:a.expired,{data:j,isLoading:O}=C({queryKey:["chat",s],queryFn:()=>ee(s),enabled:!!a&&x}),S=f({mutationFn:G,onSuccess:()=>{m.success("Successfully joined the event!"),o.invalidateQueries({queryKey:["event",s]}),o.invalidateQueries({queryKey:["tasks",s]})},onError:d=>{var h,y;m.error(((y=(h=d.response)==null?void 0:h.data)==null?void 0:y.message)||"Failed to join event.")}}),M=f({mutationFn:W,onSuccess:()=>{m.success("Event deleted successfully."),o.invalidateQueries({queryKey:["events"]}),r("/")},onError:d=>{var h,y;m.error(((y=(h=d.response)==null?void 0:h.data)==null?void 0:y.message)||"You do not have permission to delete this event.")}});p.useEffect(()=>{var d;(d=i.current)==null||d.scrollIntoView({behavior:"smooth"})},[j]),p.useEffect(()=>{if(t&&t.connected&&s&&x){const d=t.subscribe(`/topic/chat/${s}`,B=>{const q=JSON.parse(B.body);o.setQueryData(["chat",s],D=>D?[...D,q]:[q])}),h=t.subscribe(`/topic/tasks/${s}`,()=>{o.invalidateQueries({queryKey:["tasks",s]})}),y=t.subscribe(`/topic/tasks/deleted/${s}`,()=>{o.invalidateQueries({queryKey:["tasks",s]})});return()=>{d.unsubscribe(),h.unsubscribe(),y.unsubscribe()}}},[t,s,o,x]);const z=d=>{if(d.preventDefault(),l.trim()&&(t!=null&&t.connected)&&!g){const h={sender:c.username,content:l};t.publish({destination:`/app/chat.sendMessage/${s}`,body:JSON.stringify(h)}),u("")}},I=()=>{window.confirm("Are you sure you want to delete this event? This action cannot be undone.")&&M.mutate(s)};return n?e.jsx(_,{}):b?e.jsx("div",{className:"text-center text-red-500 p-8",children:"Could not load event. It may have been deleted."}):x?e.jsxs(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"container mx-auto p-4",children:[g&&e.jsxs("div",{className:"flex items-center gap-4 bg-yellow-500/10 text-yellow-400 p-4 rounded-lg mb-6",children:[e.jsx(Z,{size:20}),e.jsx("p",{children:"This event has finished. You can view the tasks and chat history, but you cannot create new tasks or send messages."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"p-6 bg-white dark:bg-white/10 backdrop-blur-xl border border-gray-200 dark:border-white/20 shadow-lg rounded-2xl",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:a.name}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:a.description})]}),E&&!g&&e.jsxs(v,{onClick:I,disabled:M.isPending,variant:"outline",className:"text-red-500 hover:bg-red-500/10 border-red-500/50",children:[e.jsx($,{size:16,className:"mr-2"}),"Delete Event"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-indigo-400"})," ",new Date(a.date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-indigo-400"})," ",a.location]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-indigo-400"})," ",a.members.length," participants"]})]})]}),e.jsxs("div",{className:"p-6 bg-white dark:bg-white/10 backdrop-blur-xl border border-gray-200 dark:border-white/20 shadow-lg rounded-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Tasks"}),e.jsx(ge,{eventId:s,isMember:x,isCreator:E,isExpired:g})]})]}),e.jsxs("div",{className:"lg:col-span-1 flex flex-col h-[80vh] bg-white dark:bg-white/10 backdrop-blur-xl border border-gray-200 dark:border-white/20 shadow-lg rounded-2xl",children:[e.jsx("h2",{className:"text-xl font-bold p-4 border-b border-gray-200 dark:border-white/20",children:"Event Chat"}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[O&&e.jsx("p",{className:"text-center",children:"Loading messages..."}),j==null?void 0:j.map((d,h)=>e.jsx("div",{className:`flex ${d.sender===c.username?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs p-3 rounded-lg ${d.sender===c.username?"bg-indigo-500 text-white":"bg-gray-200 dark:bg-gray-700"}`,children:[e.jsx("p",{className:"font-bold text-sm",children:d.sender}),e.jsx("p",{children:d.content})]})},h)),j&&j.length===0&&e.jsx("p",{className:"text-center text-gray-400 pt-4",children:"No messages yet. Say hello!"}),e.jsx("div",{ref:i})]}),e.jsxs("form",{onSubmit:z,className:"p-4 border-t border-gray-200 dark:border-white/20 flex gap-2",children:[e.jsx("input",{type:"text",placeholder:g?"Chat is closed for this event":"Type a message...",className:"flex-1 w-full px-3 py-2 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-white/20 rounded-md placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50",value:l,onChange:d=>u(d.target.value),disabled:g}),e.jsx(v,{type:"submit",className:"p-2",disabled:g,children:e.jsx(de,{className:"w-5 h-5"})})]})]})]})]}):e.jsx(Q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"w-full max-w-2xl p-8 bg-white dark:bg-white/10 backdrop-blur-xl border border-gray-200 dark:border-white/20 shadow-lg rounded-2xl text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:a.name}),g?e.jsx("p",{className:"text-lg text-yellow-400 mb-6",children:"This event has already finished and is no longer open for joining."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg text-gray-500 dark:text-gray-400 mb-6",children:"You must join this event to see the full details and participate."}),e.jsxs(v,{onClick:()=>S.mutate(s),disabled:S.isPending,className:"mx-auto",children:[e.jsx(te,{className:"w-5 h-5 mr-2"}),S.isPending?"Joining...":"Join Event"]})]})]})})})};export{Se as default};
